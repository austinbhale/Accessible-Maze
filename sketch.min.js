var cols,rows,canvas,canvasPosX,canvasPosY,current,imgSit,track,audioContext,successSound,nextLevelSound,panner,originalPos,ambientSound,pannerAmbient,ambientCurrPos,ambientOriginalPos,mobileAmbientSound,mobileFailSound,w=280,canvasSize=560,counter=1,grid=[],stack=[],currCellLoc=0,randRow=0,lastCol=0,level=1,profIdx=0,isMobile=detectMobileBrowser(),lineWeight=6,imgs=[];function preload(){imgs.push(loadImage("imgs/profs/bishop.jpeg")),imgs.push(loadImage("imgs/profs/fuchs.png")),imgs.push(loadImage("imgs/profs/jeffay.png")),imgs.push(loadImage("imgs/profs/kmp.jpeg")),imgs.push(loadImage("imgs/profs/kris.jpg")),imgs.push(loadImage("imgs/profs/majikes.jpg")),imgs.push(loadImage("imgs/profs/mcmillan.jpeg")),imgs.push(loadImage("imgs/profs/pizer.jpeg")),imgs.push(loadImage("imgs/profs/singh.jpeg")),imgs.push(loadImage("imgs/profs/stotts.jpeg")),imgs.push(loadImage("imgs/profs/tessa.jpg")),imgs.push(loadImage("imgs/profs/plaisted.jpeg")),imgSit=loadImage("imgs/sittersonhome.jpg")}function setup(){}function nextLevel(){counter%3==0&&0!=counter?(w/=2,level++,console.log("Level: "+level),counter=1):counter++,console.log("Counter = "+counter),createNewMaze()}function previousLevel(){level>1&&(w*=2,level-=1,counter=1),createNewMaze()}function playAgain(){var e=document.getElementById("play-again");w*=Math.pow(2,level-1),level=1,counter=1,createNewMaze(),e.style.visibility="hidden"}function windowResized(){!checkCanvasScreenSize()&&canPlay()&&loaded&&(resizeCanvas(canvasSize,canvasSize),canvas.position(canvasPosX,canvasPosY),createNewMaze())}function createNewMaze(){document.activeElement!=document.body&&document.activeElement.blur(),document.getElementById("play-again").style.visibility="hidden",clear(),grid=[],stack=[],currCellLoc=0,cols=floor(width/w),rows=floor(height/w),randRow=randomNumber(0,rows-1);for(var e=0;e<rows;e++)for(var o=0;o<cols;o++){var n=new Cell(o,e);grid.push(n)}for(current=grid[currCellLoc];;){for(o=0;o<grid.length;o++)grid[o].show();current.visited=!0;var t=current.checkNeighbors();if(t?(t.visited=!0,stack.push(current),removeWalls(current,t),current=t):stack.length>0&&(current=stack.pop()),current==grid[0]){console.log("maze created"),current.highlightPlayer(0,255,0);break}}strokeWeight(lineWeight),stroke(0),line(0,0,0,height),line(0,height,width,height),line(width,height,width,0),line(width,0,0,0),successSound&&adjustGoalSound(),document.getElementById("level").innerHTML=`Level: ${level}`}function keyPressed(){if(canPlay()&&!isMobile)if(track.connect(panner).connect(audioContext.destination),panner.positionX.value=originalPos.x,panner.positionY.value=originalPos.y,panner.positionZ.value=originalPos.z,keyCode==UP_ARROW)moveUp();else if(keyCode==RIGHT_ARROW)moveRight();else if(keyCode==DOWN_ARROW)moveDown();else if(keyCode==LEFT_ARROW)moveLeft();else{if(keyCode==ENTER)return console.log("enter"),void createNewMaze();keyCode==SHIFT&&(console.log("shift: previous level"),previousLevel())}}function index(e,o){return e<0||o<0||e>cols-1||o>rows-1?-1:e+o*cols}function Cell(e,o){this.i=e,this.j=o,this.walls=[!0,!0,!0,!0],this.visited=!1,this.checkNeighbors=function(){var n=[],t=grid[index(e,o-1)],i=grid[index(e+1,o)],l=grid[index(e,o+1)],a=grid[index(e-1,o)];return t&&!t.visited&&n.push(t),i&&!i.visited&&n.push(i),l&&!l.visited&&n.push(l),a&&!a.visited&&n.push(a),n.length>0?n[floor(random(0,n.length))]:void 0},this.show=function(){var e=this.i*w,o=this.j*w;strokeWeight(lineWeight),stroke(0),this.walls[0]&&line(e,o,e+w,o),this.walls[1]&&line(e+w,o,e+w,o+w),this.walls[2]&&line(e+w,o+w,e,o+w),this.walls[3]&&line(e,o+w,e,o),this.visited&&(noStroke(),erase(),fill(0,0,0),rect(e+lineWeight/2,o+lineWeight/2,w,w),noErase(),fill(75,156,211),rect(e+lineWeight/2,o+lineWeight/2,w,w),lastCol=Math.sqrt(grid.length)-1,noStroke(),fill(51,153,51),image(imgSit,lastCol*w+lineWeight/2,randRow*w+lineWeight/2,w,w-lineWeight))},this.fillAfterErase=function(e,o,n){var t=this.i*w,i=this.j*w;noStroke(),fill(e,o,n),rect(t+w/8,i+w/8,3*w/4,3*w/4)},this.mazeCleared=function(){if(isFinalRowCol()){if(console.log("same level: different maze"),nextLevelSound.play(),4===level&&counter%3==0)document.getElementById("play-again").style.visibility="visible";profIdx=++profIdx>11?0:profIdx,nextLevel()}console.log("entered maze cleared function")},this.highlightPlayer=function(e,o,n,t){var i=this.i*w,l=this.j*w;noStroke(),fill(e,o,n),t?rect(i+w/6,l+w/6,w/1.5,w/1.5):image(imgs[profIdx],i+w/4,l+w/4,w/2,w/2)}}function getCurrRow(){return floor(currCellLoc/cols)}function getCurrCol(){return currCellLoc-cols*getCurrRow()}function isFinalRowCol(){return getCurrRow()===randRow&&getCurrCol()===lastCol}function removeWalls(e,o){var n=e.i-o.i;1===n?(e.walls[3]=!1,o.walls[1]=!1):-1===n&&(e.walls[1]=!1,o.walls[3]=!1);var t=e.j-o.j;1===t?(e.walls[0]=!1,o.walls[2]=!1):-1===t&&(e.walls[2]=!1,o.walls[0]=!1)}function randomNumber(e,o){return e=Math.ceil(e),o=Math.floor(o),Math.floor(Math.random()*(o-e+1))+e}function moveUp(){isMobile||(track.connect(panner).connect(audioContext.destination),panner.positionX.value=originalPos.x,panner.positionY.value=originalPos.y,panner.positionZ.value=originalPos.z),console.log("up");let e=void 0;current.walls[0]?(console.log("hit a wall..."),isMobile?mobileFailSound.play():(panner.positionY.value+=5e3,failSound.play())):(console.log("SUCCESS!"),e=grid[currCellLoc-=cols],stopAndPlaySound(),document.getElementById("upArrow").focus()),document.getElementById("upArrow").style.backgroundColor="green",setTimeout(function(){document.getElementById("upArrow").style.backgroundColor="#4B9CD3"},200),movePlayer(e)}function moveDown(){isMobile||(track.connect(panner).connect(audioContext.destination),panner.positionX.value=originalPos.x,panner.positionY.value=originalPos.y,panner.positionZ.value=originalPos.z);let e=void 0;console.log("down"),console.log("down"),current.walls[2]?(console.log("hit a wall..."),isMobile?mobileFailSound.play():(panner.positionY.value-=5e3,failSound.play())):(console.log("SUCCESS!"),e=grid[currCellLoc+=cols],stopAndPlaySound(),document.getElementById("downArrow").focus()),document.getElementById("downArrow").style.backgroundColor="green",setTimeout(function(){document.getElementById("downArrow").style.backgroundColor="#4B9CD3"},200),movePlayer(e)}function moveLeft(){isMobile||(track.connect(panner).connect(audioContext.destination),panner.positionX.value=originalPos.x,panner.positionY.value=originalPos.y,panner.positionZ.value=originalPos.z);let e=void 0;console.log("left"),current.walls[3]?(console.log("hit a wall..."),isMobile?mobileFailSound.play():(panner.positionX.value-=5e3,failSound.play())):(console.log("SUCCESS!"),e=grid[currCellLoc-=1],stopAndPlaySound(),document.getElementById("leftArrow").focus()),document.getElementById("leftArrow").style.backgroundColor="green",setTimeout(function(){document.getElementById("leftArrow").style.backgroundColor="#4B9CD3"},200),movePlayer(e)}function moveRight(){isMobile||(track.connect(panner).connect(audioContext.destination),panner.positionX.value=originalPos.x,panner.positionY.value=originalPos.y,panner.positionZ.value=originalPos.z),console.log("right");let e=void 0;current.walls[1]?(console.log("hit a wall..."),isMobile?mobileFailSound.play():(panner.positionX.value+=5e3,failSound.play())):(console.log("SUCCESS!"),e=grid[currCellLoc+=1],stopAndPlaySound(),document.getElementById("rightArrow").focus()),document.getElementById("rightArrow").style.backgroundColor="green",setTimeout(function(){document.getElementById("rightArrow").style.backgroundColor="#4B9CD3"},200),movePlayer(e)}function movePlayer(e){void 0!==e&&(erase(),current.highlightPlayer(0,0,0,!0),noErase(),current.fillAfterErase(75,156,211),(current=e).highlightPlayer(0,255,0,!1),current.mazeCleared(),adjustGoalSound())}function stopAndPlaySound(){isFinalRowCol()?(nextLevelSound.pause(),nextLevelSound.currentTime=0,nextLevelSound.play()):(successSound.pause(),successSound.currentTime=0,successSound.play())}function adjustGoalSound(){let e=.5;e*=2;let o=abs(randRow-getCurrRow())+abs(lastCol-getCurrCol()),n=rows+cols-2,t=Math.pow(2,n-o)/Math.pow(2,n);t*=1,console.log("plaisted volume: "+t),isMobile||(document.getElementById("ambient").volume=t)}function createSound(){const e=window.AudioContext||window.webkitAudioContext;if(audioContext=new e,successSound=document.querySelector("#success"),failSound=document.querySelector("#fail"),mobileFailSound=document.querySelector("#fail"),nextLevelSound=document.querySelector("#nextlevel"),ambientSound=document.querySelector("#ambient"),isMobile);else{track=audioContext.createMediaElementSource(failSound),trackAmbient=audioContext.createMediaElementSource(ambientSound);let e=audioContext.listener;const o=window.innerWidth/2,n=window.innerHeight/2,t=300;originalPos={x:o,y:n,z:t-5},e.forwardX.value=0,e.forwardY.value=0,e.upZ.value=0,e.positionX.value=originalPos.x,e.positionY.value=originalPos.y,e.positionZ.value=originalPos.z;const i="HRTF",l="linear",a=1e4,r=1,s=10,c=o,u=n,d=t,g=0,m=0,p=-1;panner=new PannerNode(audioContext,{panningModel:i,distanceModel:l,positionX:c,positionY:u,positionZ:d,orientationX:g,orientationY:m,orientationZ:p,refDistance:r,maxDistance:a,rolloffFactor:s,coneInnerAngle:60,coneOuterAngle:90,coneOuterGain:.3}),pannerAmbient=new PannerNode(audioContext,{panningModel:i,distanceModel:l,positionX:c,positionY:u,positionZ:d,orientationX:g,orientationY:m,orientationZ:p,refDistance:r,maxDistance:a,rolloffFactor:s,coneInnerAngle:30,coneOuterAngle:45,coneOuterGain:.15}),ambientOriginalPos=ambientCurrPos={x:o,y:n,z:t-5+9e3},trackAmbient.connect(pannerAmbient).connect(audioContext.destination),ambientSound.play(),document.getElementById("ambient").loop=!0,adjustGoalSound()}}function loadGame(){loaded&&(checkCanvasScreenSize(),(canvas=createCanvas(canvasSize,canvasSize)).position(canvasPosX,canvasPosY),document.getElementById("intro").style.display="none",document.getElementById("startGameBtn").style.display="none",document.getElementById("buttons").style.display="block",(nextLevelSound=document.querySelector("#nextlevel")).play(),createNewMaze(),createSound())}function checkCanvasScreenSize(){let e=canvasSize;return window.innerWidth<1250?(w=240/level,canvasSize=480,canvasPosX=5,canvasPosY=100):(w=280/level,canvasSize=560,canvasPosX=50,canvasPosY=100),e==canvasSize}function canPlay(){return"none"==document.getElementById("intro").style.display}function detectMobileBrowser(){return navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i)}var loaded=!1;window.addEventListener("load",function(){var e=setInterval(function(){document.getElementById("defaultCanvas0")&&(clearInterval(e),loaded=!0);console.log("hello")},100);document.getElementById("level").innerHTML=`Level: ${level}`}),document.documentElement.addEventListener("mousedown",function(){window.Tone&&"running"!==window.Tone.context.state&&Tone.context.resume()}),document.body.onkeyup=function(e){32==e.keyCode&&loadGame()};